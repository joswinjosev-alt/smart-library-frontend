// ===== BACKEND URL =====
const API_URL = "https://smart-library-backend-1.onrender.com";

// ===== Update seat display =====
function updateSeatColors(seats) {
    Object.keys(seats).forEach(seatId => {
        const el = document.getElementById(seatId);
        if (!el) return;

        const status = seats[seatId].toLowerCase();  // <--- IMPORTANT

        if (status === "free") {
            el.style.background = "white";
            el.style.color = "black";
        }
        else if (status === "occupied") {
            el.style.background = "#F44336";
            el.style.color = "white";
        }
        else if (status === "reserved") {
            el.style.background = "#FFC107";
            el.style.color = "black";
        }

        el.querySelector(".status").textContent = status;
    });
}

// ===== Update stats =====
function updateStats(seats) {
    const values = Object.values(seats).map(x => x.toLowerCase());

    document.getElementById("freeCnt").textContent = values.filter(s => s === "free").length;
    document.getElementById("occCnt").textContent = values.filter(s => s === "occupied").length;
    document.getElementById("resCnt").textContent = values.filter(s => s === "reserved").length;
}

// ===== Fetch from backend every 1 second =====
async function fetchSeatData() {
    try {
        const res = await fetch(`${API_URL}/seats`);
        const data = await res.json();

        updateSeatColors(data);
        updateStats(data);

    } catch (e) {
        console.log("Backend not reachable");
    }
}

setInterval(fetchSeatData, 1000);
fetchSeatData();
